{"ast":null,"code":"import _toConsumableArray from\"/Users/richardmcgirt/Desktop/Warrenty2-/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _createForOfIteratorHelper from\"/Users/richardmcgirt/Desktop/Warrenty2-/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _regeneratorRuntime from\"/Users/richardmcgirt/Desktop/Warrenty2-/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _slicedToArray from\"/Users/richardmcgirt/Desktop/Warrenty2-/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/Users/richardmcgirt/Desktop/Warrenty2-/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React,{useState,useEffect}from'react';import'./App.css';import{useSession,useSupabaseClient,useSessionContext}from'@supabase/auth-helpers-react';// Helper to debounce API calls\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function debounce(fn,delay){var timeoutId;return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}if(timeoutId){clearTimeout(timeoutId);}timeoutId=setTimeout(function(){fn.apply(void 0,args);},delay);};}function createGoogleCalendarEvent(_x,_x2,_x3,_x4,_x5){return _createGoogleCalendarEvent.apply(this,arguments);}function _createGoogleCalendarEvent(){_createGoogleCalendarEvent=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event,calendarId,session,signOut,setRateLimitInfo){var url,newEvent,response,data,remaining,limit,reset;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:console.log(\"Attempting to create a new Google Calendar event for calendar: \".concat(calendarId),event);if(session.provider_token){_context.next=5;break;}console.error('No valid session token available. Logging out.');signOut();return _context.abrupt(\"return\",null);case 5:url=\"https://www.googleapis.com/calendar/v3/calendars/\".concat(calendarId,\"/events\");newEvent={summary:event.title,description:event.description,start:{dateTime:event.start.toISOString()},end:{dateTime:event.end.toISOString()},location:\"\".concat(event.streetAddress,\", \").concat(event.city,\", \").concat(event.state,\", \").concat(event.zipCode)};console.log('Event data being sent to Google Calendar API:',newEvent);_context.prev=8;_context.next=11;return fetch(url,{method:'POST',headers:{Authorization:'Bearer '+session.provider_token,'Content-Type':'application/json'},body:JSON.stringify(newEvent)});case 11:response=_context.sent;_context.next=14;return response.json();case 14:data=_context.sent;console.log('Google Calendar API response:',data);// Detailed log for each response\n// Capture rate limit info from headers\nremaining=response.headers.get('X-RateLimit-Remaining');limit=response.headers.get('X-RateLimit-Limit');reset=response.headers.get('X-RateLimit-Reset');setRateLimitInfo({remaining:remaining,limit:limit,reset:reset});if(!response.ok){_context.next=25;break;}console.log('Event successfully created in Google Calendar with ID:',data.id);return _context.abrupt(\"return\",data.id);case 25:console.error('Failed to create event:',data);if(data.error.code===401){console.error('Unauthorized - Logging out');signOut();// Logout if unauthorized\n}return _context.abrupt(\"return\",null);case 28:_context.next=34;break;case 30:_context.prev=30;_context.t0=_context[\"catch\"](8);console.error('Error during Google Calendar API request:',_context.t0);return _context.abrupt(\"return\",null);case 34:case\"end\":return _context.stop();}},_callee,null,[[8,30]]);}));return _createGoogleCalendarEvent.apply(this,arguments);}function updateAirtableWithGoogleEventId(_x6,_x7){return _updateAirtableWithGoogleEventId.apply(this,arguments);}function _updateAirtableWithGoogleEventId(){_updateAirtableWithGoogleEventId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(airtableRecordId,googleEventId){var url,updateData,response,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:console.log(\"Updating Airtable record \".concat(airtableRecordId,\" with Google Event ID: \").concat(googleEventId));url=\"https://api.airtable.com/v0/appO21PVRA4Qa087I/tbl6EeKPsNuEvt5yJ/\".concat(airtableRecordId);updateData={fields:{GoogleEventId:googleEventId}};_context2.prev=3;_context2.next=6;return fetch(url,{method:'PATCH',headers:{'Authorization':'Bearer patXTUS9m8os14OO1.6a81b7bc4dd88871072fe71f28b568070cc79035bc988de3d4228d52239c8238','Content-Type':'application/json'},body:JSON.stringify(updateData)});case 6:response=_context2.sent;_context2.next=9;return response.json();case 9:data=_context2.sent;console.log('Airtable update response:',data);if(data.error){console.error('Error updating Airtable with Google Event ID:',data.error);}else{console.log('Airtable record successfully updated with Google Event ID:',data);}_context2.next=17;break;case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](3);console.error('Error during Airtable API request:',_context2.t0);case 17:case\"end\":return _context2.stop();}},_callee2,null,[[3,14]]);}));return _updateAirtableWithGoogleEventId.apply(this,arguments);}function fetchAirtableEvents(){return _fetchAirtableEvents.apply(this,arguments);}function _fetchAirtableEvents(){_fetchAirtableEvents=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var retryCount,url,maxRetries,response,retryAfter,waitTime,data,filteredRecords,_args3=arguments;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:retryCount=_args3.length>0&&_args3[0]!==undefined?_args3[0]:0;console.log('Fetching events from Airtable...');url=\"https://api.airtable.com/v0/appO21PVRA4Qa087I/tbl6EeKPsNuEvt5yJ\";maxRetries=1;_context3.prev=4;_context3.next=7;return fetch(url,{headers:{'Authorization':'Bearer patXTUS9m8os14OO1.6a81b7bc4dd88871072fe71f28b568070cc79035bc988de3d4228d52239c8238','Content-Type':'application/json'}});case 7:response=_context3.sent;if(response.ok){_context3.next=23;break;}if(!(response.status===429)){_context3.next=22;break;}retryAfter=response.headers.get('Retry-After');waitTime=retryAfter?parseInt(retryAfter)*1000:Math.pow(2,retryCount)*1000;console.warn(\"Rate limit hit. Retrying after \".concat(waitTime,\"ms...\"));if(!(retryCount<maxRetries)){_context3.next=19;break;}_context3.next=16;return new Promise(function(resolve){return setTimeout(resolve,waitTime);});case 16:return _context3.abrupt(\"return\",fetchAirtableEvents(retryCount+1));case 19:throw new Error('Max retries exceeded');case 20:_context3.next=23;break;case 22:throw new Error(\"HTTP error! status: \".concat(response.status));case 23:_context3.next=25;return response.json();case 25:data=_context3.sent;console.log('Raw Airtable data fetched:',data);filteredRecords=data.records.filter(function(record){// Log any record that is filtered out\nvar hasEventName=!!record.fields['Calendar Event Name'];var hasStartDate=!!record.fields['StartDate'];var hasEndDate=!!record.fields['EndDate'];if(!hasEventName||!hasStartDate||!hasEndDate){console.warn(\"Record filtered out: \".concat(record.id),{eventName:record.fields['Calendar Event Name'],startDate:record.fields['StartDate'],endDate:record.fields['EndDate']});return false;}return true;}).map(function(record){return{id:record.id,title:record.fields['Calendar Event Name']||'Untitled Event',start:new Date(record.fields['StartDate']),end:new Date(record.fields['EndDate']),description:record.fields['Billable Reason (If Billable)']||'',branch:record.fields['b']||'Unknown',homeownerName:record.fields['Homeowner Name']||'Unknown',streetAddress:record.fields['Street Address']||'Unknown',city:record.fields['City']||'Unknown',state:record.fields['State']||'Unknown',zipCode:record.fields['Zip Code']||'Unknown',googleEventId:record.fields['GoogleEventId']||null};});console.log(\"Airtable events to process: \".concat(filteredRecords.length),filteredRecords);return _context3.abrupt(\"return\",filteredRecords);case 32:_context3.prev=32;_context3.t0=_context3[\"catch\"](4);console.error('Error fetching events from Airtable:',_context3.t0);if(!(retryCount<maxRetries)){_context3.next=40;break;}console.log(\"Retrying fetch attempt \".concat(retryCount+1,\" of \").concat(maxRetries,\"...\"));return _context3.abrupt(\"return\",fetchAirtableEvents(retryCount+1));case 40:throw _context3.t0;case 41:case\"end\":return _context3.stop();}},_callee3,null,[[4,32]]);}));return _fetchAirtableEvents.apply(this,arguments);}function checkForDuplicateEvent(_x8,_x9,_x10){return _checkForDuplicateEvent.apply(this,arguments);}function _checkForDuplicateEvent(){_checkForDuplicateEvent=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(event,calendarId,session){var url,response,data,isDuplicate;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:console.log(\"Checking for duplicate events in Google Calendar for event: \".concat(event.title));url=\"https://www.googleapis.com/calendar/v3/calendars/\".concat(calendarId,\"/events?timeMin=\").concat(event.start.toISOString(),\"&timeMax=\").concat(event.end.toISOString());_context4.prev=2;_context4.next=5;return fetch(url,{headers:{Authorization:'Bearer '+session.provider_token}});case 5:response=_context4.sent;_context4.next=8;return response.json();case 8:data=_context4.sent;if(!data.items){_context4.next=13;break;}isDuplicate=data.items.some(function(existingEvent){return existingEvent.summary===event.title&&existingEvent.location===\"\".concat(event.streetAddress,\", \").concat(event.city,\", \").concat(event.state,\", \").concat(event.zipCode);});console.log(\"Duplicate check for event \\\"\".concat(event.title,\"\\\": \").concat(isDuplicate?'Found duplicate':'No duplicate'));return _context4.abrupt(\"return\",isDuplicate);case 13:_context4.next=19;break;case 15:_context4.prev=15;_context4.t0=_context4[\"catch\"](2);console.error('Error checking for duplicate events in Google Calendar:',_context4.t0);return _context4.abrupt(\"return\",false);case 19:case\"end\":return _context4.stop();}},_callee4,null,[[2,15]]);}));return _checkForDuplicateEvent.apply(this,arguments);}function sleep(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});}function checkIfAirtableRecordExists(_x11,_x12,_x13){return _checkIfAirtableRecordExists.apply(this,arguments);}function _checkIfAirtableRecordExists(){_checkIfAirtableRecordExists=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(eventTitle,eventStart,eventEnd){var url,response,data;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:url=\"https://api.airtable.com/v0/appO21PVRA4Qa087I/tbl6EeKPsNuEvt5yJ?filterByFormula=AND({Calendar Event Name}=\\\"\".concat(eventTitle,\"\\\", {StartDate}=\\\"\").concat(eventStart.toISOString(),\"\\\", {EndDate}=\\\"\").concat(eventEnd.toISOString(),\"\\\")\");_context5.prev=1;_context5.next=4;return fetch(url,{headers:{Authorization:'Bearer patXTUS9m8os14OO1.6a81b7bc4dd88871072fe71f28b568070cc79035bc988de3d4228d52239c8238','Content-Type':'application/json'}});case 4:response=_context5.sent;_context5.next=7;return response.json();case 7:data=_context5.sent;return _context5.abrupt(\"return\",data.records.length>0?data.records[0]:null);case 11:_context5.prev=11;_context5.t0=_context5[\"catch\"](1);console.error('Error checking Airtable for existing record:',_context5.t0);return _context5.abrupt(\"return\",null);case 15:case\"end\":return _context5.stop();}},_callee5,null,[[1,11]]);}));return _checkIfAirtableRecordExists.apply(this,arguments);}function populateGoogleCalendarWithAirtableRecords(_x14,_x15,_x16,_x17,_x18,_x19,_x20){return _populateGoogleCalendarWithAirtableRecords.apply(this,arguments);}function _populateGoogleCalendarWithAirtableRecords(){_populateGoogleCalendarWithAirtableRecords=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(calendarId,calendarName,session,signOut,setAddedRecords,setFailedRecords,setRateLimitInfo){var airtableEvents,added,failed,_iterator,_step,event,existingAirtableRecord,isDuplicate,googleEventId;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:console.log(\"Starting to populate Google Calendar \\\"\".concat(calendarName,\"\\\" with Airtable records...\"));_context6.next=3;return fetchAirtableEvents();case 3:airtableEvents=_context6.sent;console.log(\"Processing \".concat(airtableEvents.length,\" Airtable events for Google Calendar sync...\"));added=[];failed=[];_iterator=_createForOfIteratorHelper(airtableEvents);_context6.prev=8;_iterator.s();case 10:if((_step=_iterator.n()).done){_context6.next=46;break;}event=_step.value;console.log(\"Processing event \\\"\".concat(event.title,\"\\\"...\"));if(!(event.branch.toLowerCase()==='unknown'||event.branch.toLowerCase()!==calendarName.toLowerCase())){_context6.next=16;break;}console.log(\"Skipping event \\\"\".concat(event.title,\"\\\" due to branch \\\"\").concat(event.branch,\"\\\" not matching \\\"\").concat(calendarName,\"\\\" or being \\\"Unknown\\\"\"));return _context6.abrupt(\"continue\",44);case 16:_context6.next=18;return checkIfAirtableRecordExists(event.title,event.start,event.end);case 18:existingAirtableRecord=_context6.sent;if(!existingAirtableRecord){_context6.next=23;break;}console.log(\"Event \\\"\".concat(event.title,\"\\\" already exists in Airtable. Skipping creation.\"));failed.push(event.title);return _context6.abrupt(\"continue\",44);case 23:_context6.next=25;return checkForDuplicateEvent(event,calendarId,session);case 25:isDuplicate=_context6.sent;if(!isDuplicate){_context6.next=30;break;}console.log(\"Duplicate event found: \\\"\".concat(event.title,\"\\\". Skipping...\"));failed.push(event.title);return _context6.abrupt(\"continue\",44);case 30:_context6.next=32;return createGoogleCalendarEvent(event,calendarId,session,signOut,setRateLimitInfo);case 32:googleEventId=_context6.sent;if(!googleEventId){_context6.next=40;break;}console.log('New Google Event ID created:',googleEventId);_context6.next=37;return updateAirtableWithGoogleEventId(event.id,googleEventId);case 37:added.push(event.title);_context6.next=42;break;case 40:console.log(\"Failed to create Google Calendar event for \\\"\".concat(event.title,\"\\\".\"));failed.push(event.title);case 42:_context6.next=44;return sleep(1000);case 44:_context6.next=10;break;case 46:_context6.next=51;break;case 48:_context6.prev=48;_context6.t0=_context6[\"catch\"](8);_iterator.e(_context6.t0);case 51:_context6.prev=51;_iterator.f();return _context6.finish(51);case 54:setAddedRecords(function(prev){return[].concat(_toConsumableArray(prev),added);});setFailedRecords(function(prev){return[].concat(_toConsumableArray(prev),failed);});console.log(\"Finished populating Google Calendar \\\"\".concat(calendarName,\"\\\" with Airtable records.\"));case 57:case\"end\":return _context6.stop();}},_callee6,null,[[8,48,51,54]]);}));return _populateGoogleCalendarWithAirtableRecords.apply(this,arguments);}function CalendarSection(_ref){var calendarId=_ref.calendarId,calendarName=_ref.calendarName,session=_ref.session,signOut=_ref.signOut,setAddedRecords=_ref.setAddedRecords,setFailedRecords=_ref.setFailedRecords,setRateLimitInfo=_ref.setRateLimitInfo,triggerSync=_ref.triggerSync,setTriggerSync=_ref.setTriggerSync;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),lastSyncTime=_useState2[0],setLastSyncTime=_useState2[1];useEffect(function(){var syncEvents=function syncEvents(){var now=new Date();console.log('Attempting to sync events...');if(lastSyncTime&&now-lastSyncTime<900000){console.log('Sync skipped. Last sync was less than 15 minutes ago.');return;}if(session&&triggerSync){if(!session.provider_token){console.error('No valid session token found. Logging out.');signOut();return;}console.log('Session valid. Initiating sync...');populateGoogleCalendarWithAirtableRecords(calendarId,calendarName,session,signOut,setAddedRecords,setFailedRecords,setRateLimitInfo).then(function(){console.log(\"Finished syncing events to Google Calendar \\\"\".concat(calendarName,\"\\\"\"));setLastSyncTime(new Date());// Update last sync time\nsetTriggerSync(false);// Reset the triggerSync after sync\n}).catch(function(error){return console.error(\"Error syncing Airtable to Google Calendar \\\"\".concat(calendarName,\"\\\":\"),error);});}};if(triggerSync){console.log(\"Manual sync triggered for calendar: \".concat(calendarName));syncEvents();}},[session,signOut,calendarId,calendarName,setAddedRecords,setFailedRecords,setRateLimitInfo,lastSyncTime,triggerSync,setTriggerSync]);return/*#__PURE__*/_jsx(\"div\",{className:\"calendar-item\",children:/*#__PURE__*/_jsx(\"h2\",{children:calendarName})});}function App(){var session=useSession();var supabase=useSupabaseClient();var _useSessionContext=useSessionContext(),isLoading=_useSessionContext.isLoading;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),addedRecords=_useState4[0],setAddedRecords=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),failedRecords=_useState6[0],setFailedRecords=_useState6[1];var _useState7=useState({remaining:null,limit:null,reset:null}),_useState8=_slicedToArray(_useState7,2),rateLimitInfo=_useState8[0],setRateLimitInfo=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),triggerSync=_useState10[0],setTriggerSync=_useState10[1];var calendarInfo=[{id:'c_ebe1fcbce1be361c641591a6c389d4311df7a97961af0020c889686ae059d20a@group.calendar.google.com',name:'Savannah'}].sort(function(a,b){return a.name.localeCompare(b.name);});var handleSyncNow=function handleSyncNow(){console.log('Manual sync button clicked.');setTriggerSync(true);// Trigger manual sync\n};var getGreeting=function getGreeting(){var currentHour=new Date().getHours();if(currentHour<12){return'Good morning';}else if(currentHour<18){return'Good afternoon';}else{return'Good evening';}};if(isLoading){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Warranty Calendar\"}),/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',margin:'0 auto'},children:session?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h2\",{children:[getGreeting(),\" \",session.user.email]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSyncNow,children:\"Sync Now\"}),\" \",/*#__PURE__*/_jsx(\"div\",{className:\"calendar-grid\",children:calendarInfo.map(function(calendar){return/*#__PURE__*/_jsx(CalendarSection,{calendarId:calendar.id,calendarName:calendar.name,session:session,signOut:function signOut(){return supabase.auth.signOut();},setAddedRecords:setAddedRecords,setFailedRecords:setFailedRecords,setRateLimitInfo:setRateLimitInfo,triggerSync:triggerSync,setTriggerSync:setTriggerSync},calendar.id);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"records-summary\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Records Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"added-records\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Successfully Added Records:\"}),addedRecords.length>0?/*#__PURE__*/_jsx(\"ul\",{children:addedRecords.map(function(record,index){return/*#__PURE__*/_jsx(\"li\",{children:record},index);})}):/*#__PURE__*/_jsx(\"p\",{children:\"No records added.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"failed-records\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Failed to Add Records:\"}),failedRecords.length>0?/*#__PURE__*/_jsx(\"ul\",{children:failedRecords.map(function(record,index){return/*#__PURE__*/_jsx(\"li\",{children:record},index);})}):/*#__PURE__*/_jsx(\"p\",{children:\"No records failed.\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rate-limit-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Google Calendar API Rate Limit Information:\"}),rateLimitInfo.limit!==null?/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsxs(\"li\",{children:[\"Limit: \",rateLimitInfo.limit]}),/*#__PURE__*/_jsxs(\"li\",{children:[\"Remaining: \",rateLimitInfo.remaining]}),/*#__PURE__*/_jsxs(\"li\",{children:[\"Reset Time: \",new Date(rateLimitInfo.reset*1000).toLocaleTimeString()]})]}):/*#__PURE__*/_jsx(\"p\",{children:\"No rate limit information available.\"})]}),/*#__PURE__*/_jsx(\"p\",{}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return supabase.auth.signOut();},children:\"Sign Out\"})]}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return supabase.auth.signInWithOAuth({provider:'google',options:{scopes:'https://www.googleapis.com/auth/calendar'}});},children:\"Sign In With Google\"})})})]})});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useSession","useSupabaseClient","useSessionContext","debounce","fn","delay","timeoutId","args","clearTimeout","setTimeout","createGoogleCalendarEvent","event","calendarId","session","signOut","setRateLimitInfo","console","log","provider_token","error","url","newEvent","summary","title","description","start","dateTime","toISOString","end","location","streetAddress","city","state","zipCode","fetch","method","headers","Authorization","body","JSON","stringify","response","json","data","remaining","get","limit","reset","ok","id","code","updateAirtableWithGoogleEventId","airtableRecordId","googleEventId","updateData","fields","GoogleEventId","fetchAirtableEvents","retryCount","maxRetries","status","retryAfter","waitTime","parseInt","Math","pow","warn","Promise","resolve","Error","filteredRecords","records","filter","record","hasEventName","hasStartDate","hasEndDate","eventName","startDate","endDate","map","Date","branch","homeownerName","length","checkForDuplicateEvent","items","isDuplicate","some","existingEvent","sleep","ms","checkIfAirtableRecordExists","eventTitle","eventStart","eventEnd","populateGoogleCalendarWithAirtableRecords","calendarName","setAddedRecords","setFailedRecords","airtableEvents","added","failed","toLowerCase","existingAirtableRecord","push","prev","CalendarSection","triggerSync","setTriggerSync","lastSyncTime","setLastSyncTime","syncEvents","now","then","catch","App","supabase","isLoading","addedRecords","failedRecords","rateLimitInfo","calendarInfo","name","sort","a","b","localeCompare","handleSyncNow","getGreeting","currentHour","getHours","width","margin","user","email","calendar","auth","index","toLocaleTimeString","signInWithOAuth","provider","options","scopes"],"sources":["/Users/richardmcgirt/Desktop/Warrenty2-/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport './App.css';\nimport { useSession, useSupabaseClient, useSessionContext } from '@supabase/auth-helpers-react';\n\n// Helper to debounce API calls\nfunction debounce(fn, delay) {\n  let timeoutId;\n  return (...args) => {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = setTimeout(() => {\n      fn(...args);\n    }, delay);\n  };\n}\n\nasync function createGoogleCalendarEvent(event, calendarId, session, signOut, setRateLimitInfo) {\n  console.log(`Attempting to create a new Google Calendar event for calendar: ${calendarId}`, event);\n\n  if (!session.provider_token) {\n    console.error('No valid session token available. Logging out.');\n    signOut();\n    return null;\n  }\n\n  const url = `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events`;\n\n  const newEvent = {\n    summary: event.title,\n    description: event.description,\n    start: { dateTime: event.start.toISOString() },\n    end: { dateTime: event.end.toISOString() },\n    location: `${event.streetAddress}, ${event.city}, ${event.state}, ${event.zipCode}`,\n  };\n\n  console.log('Event data being sent to Google Calendar API:', newEvent);\n\n  try {\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        Authorization: 'Bearer ' + session.provider_token,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(newEvent),\n    });\n\n    const data = await response.json();\n    console.log('Google Calendar API response:', data); // Detailed log for each response\n\n    // Capture rate limit info from headers\n    const remaining = response.headers.get('X-RateLimit-Remaining');\n    const limit = response.headers.get('X-RateLimit-Limit');\n    const reset = response.headers.get('X-RateLimit-Reset');\n    setRateLimitInfo({ remaining, limit, reset });\n\n    if (response.ok) {\n      console.log('Event successfully created in Google Calendar with ID:', data.id);\n      return data.id;\n    } else {\n      console.error('Failed to create event:', data);\n      if (data.error.code === 401) {\n        console.error('Unauthorized - Logging out');\n        signOut(); // Logout if unauthorized\n      }\n      return null;\n    }\n  } catch (error) {\n    console.error('Error during Google Calendar API request:', error);\n    return null;\n  }\n}\n\nasync function updateAirtableWithGoogleEventId(airtableRecordId, googleEventId) {\n  console.log(`Updating Airtable record ${airtableRecordId} with Google Event ID: ${googleEventId}`);\n\n  const url = `https://api.airtable.com/v0/appO21PVRA4Qa087I/tbl6EeKPsNuEvt5yJ/${airtableRecordId}`;\n  const updateData = {\n    fields: {\n      GoogleEventId: googleEventId,\n    },\n  };\n\n  try {\n    const response = await fetch(url, {\n      method: 'PATCH',\n      headers: {\n        'Authorization': 'Bearer patXTUS9m8os14OO1.6a81b7bc4dd88871072fe71f28b568070cc79035bc988de3d4228d52239c8238',\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(updateData),\n    });\n\n    const data = await response.json();\n    console.log('Airtable update response:', data);\n\n    if (data.error) {\n      console.error('Error updating Airtable with Google Event ID:', data.error);\n    } else {\n      console.log('Airtable record successfully updated with Google Event ID:', data);\n    }\n  } catch (error) {\n    console.error('Error during Airtable API request:', error);\n  }\n}\n\nasync function fetchAirtableEvents(retryCount = 0) {\n  console.log('Fetching events from Airtable...');\n\n  const url = `https://api.airtable.com/v0/appO21PVRA4Qa087I/tbl6EeKPsNuEvt5yJ`;\n  const maxRetries = 1;\n\n  try {\n    const response = await fetch(url, {\n      headers: {\n        'Authorization': 'Bearer patXTUS9m8os14OO1.6a81b7bc4dd88871072fe71f28b568070cc79035bc988de3d4228d52239c8238',\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      if (response.status === 429) {\n        const retryAfter = response.headers.get('Retry-After');\n        const waitTime = retryAfter ? parseInt(retryAfter) * 1000 : Math.pow(2, retryCount) * 1000;\n\n        console.warn(`Rate limit hit. Retrying after ${waitTime}ms...`);\n\n        if (retryCount < maxRetries) {\n          await new Promise((resolve) => setTimeout(resolve, waitTime));\n          return fetchAirtableEvents(retryCount + 1); // Retry with incremented retry count\n        } else {\n          throw new Error('Max retries exceeded');\n        }\n      } else {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n    }\n\n    const data = await response.json();\n    console.log('Raw Airtable data fetched:', data);\n\n    const filteredRecords = data.records\n      .filter((record) => {\n        // Log any record that is filtered out\n        const hasEventName = !!record.fields['Calendar Event Name'];\n        const hasStartDate = !!record.fields['StartDate'];\n        const hasEndDate = !!record.fields['EndDate'];\n\n        if (!hasEventName || !hasStartDate || !hasEndDate) {\n          console.warn(`Record filtered out: ${record.id}`, {\n            eventName: record.fields['Calendar Event Name'],\n            startDate: record.fields['StartDate'],\n            endDate: record.fields['EndDate'],\n          });\n          return false;\n        }\n\n        return true;\n      })\n      .map((record) => ({\n        id: record.id,\n        title: record.fields['Calendar Event Name'] || 'Untitled Event',\n        start: new Date(record.fields['StartDate']),\n        end: new Date(record.fields['EndDate']),\n        description: record.fields['Billable Reason (If Billable)'] || '',\n        branch: record.fields['b'] || 'Unknown',\n        homeownerName: record.fields['Homeowner Name'] || 'Unknown',\n        streetAddress: record.fields['Street Address'] || 'Unknown',\n        city: record.fields['City'] || 'Unknown',\n        state: record.fields['State'] || 'Unknown',\n        zipCode: record.fields['Zip Code'] || 'Unknown',\n        googleEventId: record.fields['GoogleEventId'] || null,\n      }));\n\n    console.log(`Airtable events to process: ${filteredRecords.length}`, filteredRecords);\n    return filteredRecords;\n\n  } catch (error) {\n    console.error('Error fetching events from Airtable:', error);\n\n    if (retryCount < maxRetries) {\n      console.log(`Retrying fetch attempt ${retryCount + 1} of ${maxRetries}...`);\n      return fetchAirtableEvents(retryCount + 1);\n    } else {\n      throw error; // Re-throw the error after max retries\n    }\n  }\n}\n\n\nasync function checkForDuplicateEvent(event, calendarId, session) {\n  console.log(`Checking for duplicate events in Google Calendar for event: ${event.title}`);\n\n  const url = `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events?timeMin=${event.start.toISOString()}&timeMax=${event.end.toISOString()}`;\n\n  try {\n    const response = await fetch(url, {\n      headers: {\n        Authorization: 'Bearer ' + session.provider_token,\n      },\n    });\n\n    const data = await response.json();\n    if (data.items) {\n      const isDuplicate = data.items.some(\n        (existingEvent) =>\n          existingEvent.summary === event.title &&\n          existingEvent.location ===\n            `${event.streetAddress}, ${event.city}, ${event.state}, ${event.zipCode}`\n      );\n      console.log(\n        `Duplicate check for event \"${event.title}\": ${isDuplicate ? 'Found duplicate' : 'No duplicate'}`\n      );\n      return isDuplicate;\n    }\n  } catch (error) {\n    console.error('Error checking for duplicate events in Google Calendar:', error);\n    return false;\n  }\n}\n\nfunction sleep(ms) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nasync function checkIfAirtableRecordExists(eventTitle, eventStart, eventEnd) {\n  const url = `https://api.airtable.com/v0/appO21PVRA4Qa087I/tbl6EeKPsNuEvt5yJ?filterByFormula=AND({Calendar Event Name}=\"${eventTitle}\", {StartDate}=\"${eventStart.toISOString()}\", {EndDate}=\"${eventEnd.toISOString()}\")`;\n\n  try {\n    const response = await fetch(url, {\n      headers: {\n        Authorization: 'Bearer patXTUS9m8os14OO1.6a81b7bc4dd88871072fe71f28b568070cc79035bc988de3d4228d52239c8238',\n        'Content-Type': 'application/json',\n      },\n    });\n\n    const data = await response.json();\n    return data.records.length > 0 ? data.records[0] : null;\n  } catch (error) {\n    console.error('Error checking Airtable for existing record:', error);\n    return null;\n  }\n}\n\n\nasync function populateGoogleCalendarWithAirtableRecords(\n  calendarId,\n  calendarName,\n  session,\n  signOut,\n  setAddedRecords,\n  setFailedRecords,\n  setRateLimitInfo\n) {\n  console.log(`Starting to populate Google Calendar \"${calendarName}\" with Airtable records...`);\n\n  const airtableEvents = await fetchAirtableEvents();\n  console.log(`Processing ${airtableEvents.length} Airtable events for Google Calendar sync...`);\n  \n  const added = [];\n  const failed = [];\n\n  for (const event of airtableEvents) {\n    console.log(`Processing event \"${event.title}\"...`);\n  \n    if (event.branch.toLowerCase() === 'unknown' || event.branch.toLowerCase() !== calendarName.toLowerCase()) {\n      console.log(\n        `Skipping event \"${event.title}\" due to branch \"${event.branch}\" not matching \"${calendarName}\" or being \"Unknown\"`\n      );\n      continue;\n    }\n  \n    // Check if this event already exists in Airtable before creating a duplicate\n    const existingAirtableRecord = await checkIfAirtableRecordExists(event.title, event.start, event.end);\n  \n    if (existingAirtableRecord) {\n      console.log(`Event \"${event.title}\" already exists in Airtable. Skipping creation.`);\n      failed.push(event.title);\n      continue;\n    }\n  \n    const isDuplicate = await checkForDuplicateEvent(event, calendarId, session);\n    if (isDuplicate) {\n      console.log(`Duplicate event found: \"${event.title}\". Skipping...`);\n      failed.push(event.title);\n      continue;\n    }\n  \n    const googleEventId = await createGoogleCalendarEvent(\n      event,\n      calendarId,\n      session,\n      signOut,\n      setRateLimitInfo\n    );\n    if (googleEventId) {\n      console.log('New Google Event ID created:', googleEventId);\n      await updateAirtableWithGoogleEventId(event.id, googleEventId);\n      added.push(event.title);\n    } else {\n      console.log(`Failed to create Google Calendar event for \"${event.title}\".`);\n      failed.push(event.title);\n    }\n  \n    await sleep(1000); // Adding delay between requests\n  }\n  \n\n  setAddedRecords((prev) => [...prev, ...added]);\n  setFailedRecords((prev) => [...prev, ...failed]);\n\n  console.log(`Finished populating Google Calendar \"${calendarName}\" with Airtable records.`);\n}\n\nfunction CalendarSection({\n  calendarId,\n  calendarName,\n  session,\n  signOut,\n  setAddedRecords,\n  setFailedRecords,\n  setRateLimitInfo,\n  triggerSync,\n  setTriggerSync\n}) {\n  const [lastSyncTime, setLastSyncTime] = useState(null);\n\n  useEffect(() => {\n    const syncEvents = () => {\n      const now = new Date();\n      console.log('Attempting to sync events...');\n\n      if (lastSyncTime && now - lastSyncTime < 900000) {\n        console.log('Sync skipped. Last sync was less than 15 minutes ago.');\n        return;\n      }\n\n      if (session && triggerSync) {\n        if (!session.provider_token) {\n          console.error('No valid session token found. Logging out.');\n          signOut();\n          return;\n        }\n\n        console.log('Session valid. Initiating sync...');\n        populateGoogleCalendarWithAirtableRecords(\n          calendarId,\n          calendarName,\n          session,\n          signOut,\n          setAddedRecords,\n          setFailedRecords,\n          setRateLimitInfo\n        )\n          .then(() => {\n            console.log(`Finished syncing events to Google Calendar \"${calendarName}\"`);\n            setLastSyncTime(new Date()); // Update last sync time\n            setTriggerSync(false); // Reset the triggerSync after sync\n          })\n          .catch((error) =>\n            console.error(`Error syncing Airtable to Google Calendar \"${calendarName}\":`, error)\n          );\n      }\n    };\n\n    if (triggerSync) {\n      console.log(`Manual sync triggered for calendar: ${calendarName}`);\n      syncEvents();\n    }\n  }, [session, signOut, calendarId, calendarName, setAddedRecords, setFailedRecords, setRateLimitInfo, lastSyncTime, triggerSync, setTriggerSync]);\n\n  return (\n    <div className=\"calendar-item\">\n      <h2>{calendarName}</h2>\n    </div>\n  );\n}\n\nfunction App() {\n  const session = useSession();\n  const supabase = useSupabaseClient();\n  const { isLoading } = useSessionContext();\n\n  const [addedRecords, setAddedRecords] = useState([]);\n  const [failedRecords, setFailedRecords] = useState([]);\n  const [rateLimitInfo, setRateLimitInfo] = useState({ remaining: null, limit: null, reset: null });\n  const [triggerSync, setTriggerSync] = useState(false);\n\n  const calendarInfo = [\n    { id: 'c_ebe1fcbce1be361c641591a6c389d4311df7a97961af0020c889686ae059d20a@group.calendar.google.com', name: 'Savannah' }\n  ].sort((a, b) => a.name.localeCompare(b.name));\n\n  const handleSyncNow = () => {\n    console.log('Manual sync button clicked.');\n    setTriggerSync(true); // Trigger manual sync\n  };\n\n  const getGreeting = () => {\n    const currentHour = new Date().getHours();\n    if (currentHour < 12) {\n      return 'Good morning';\n    } else if (currentHour < 18) {\n      return 'Good afternoon';\n    } else {\n      return 'Good evening';\n    }\n  };\n\n  if (isLoading) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <div className=\"App\">\n      <div className=\"container\">\n        <h1>Warranty Calendar</h1>\n        <div style={{ width: '100%', margin: '0 auto' }}>\n          {session ? (\n            <>\n              <h2>{getGreeting()} {session.user.email}</h2>\n              <hr />\n              <button onClick={handleSyncNow}>Sync Now</button> {/* Manual Sync Button */}\n              <div className=\"calendar-grid\">\n                {calendarInfo.map((calendar) => (\n                  <CalendarSection\n                    key={calendar.id}\n                    calendarId={calendar.id}\n                    calendarName={calendar.name}\n                    session={session}\n                    signOut={() => supabase.auth.signOut()}\n                    setAddedRecords={setAddedRecords}\n                    setFailedRecords={setFailedRecords}\n                    setRateLimitInfo={setRateLimitInfo}\n                    triggerSync={triggerSync}\n                    setTriggerSync={setTriggerSync}\n                  />\n                ))}\n              </div>\n              <div className=\"records-summary\">\n                <h3>Records Summary</h3>\n                <div className=\"summary-container\">\n                  <div className=\"added-records\">\n                    <h4>Successfully Added Records:</h4>\n                    {addedRecords.length > 0 ? (\n                      <ul>\n                        {addedRecords.map((record, index) => (\n                          <li key={index}>{record}</li>\n                        ))}\n                      </ul>\n                    ) : (\n                      <p>No records added.</p>\n                    )}\n                  </div>\n                  <div className=\"failed-records\">\n                    <h4>Failed to Add Records:</h4>\n                    {failedRecords.length > 0 ? (\n                      <ul>\n                        {failedRecords.map((record, index) => (\n                          <li key={index}>{record}</li>\n                        ))}\n                      </ul>\n                    ) : (\n                      <p>No records failed.</p>\n                    )}\n                  </div>\n                </div>\n              </div>\n              <div className=\"rate-limit-info\">\n                <h4>Google Calendar API Rate Limit Information:</h4>\n                {rateLimitInfo.limit !== null ? (\n                  <ul>\n                    <li>Limit: {rateLimitInfo.limit}</li>\n                    <li>Remaining: {rateLimitInfo.remaining}</li>\n                    <li>Reset Time: {new Date(rateLimitInfo.reset * 1000).toLocaleTimeString()}</li>\n                  </ul>\n                ) : (\n                  <p>No rate limit information available.</p>\n                )}\n              </div>\n              <p></p>\n              <button onClick={() => supabase.auth.signOut()}>Sign Out</button>\n            </>\n          ) : (\n            <>\n              <button onClick={() => supabase.auth.signInWithOAuth({ provider: 'google', options: { scopes: 'https://www.googleapis.com/auth/calendar' } })}>\n                Sign In With Google\n              </button>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}