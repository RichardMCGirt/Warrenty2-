{"ast":null,"code":"import _toConsumableArray from\"/Users/richardmcgirt/Desktop/Warrenty2-/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _createForOfIteratorHelper from\"/Users/richardmcgirt/Desktop/Warrenty2-/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _regeneratorRuntime from\"/Users/richardmcgirt/Desktop/Warrenty2-/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _slicedToArray from\"/Users/richardmcgirt/Desktop/Warrenty2-/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/Users/richardmcgirt/Desktop/Warrenty2-/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React,{useState,useEffect}from'react';import'./App.css';import{useSession,useSupabaseClient,useSessionContext}from'@supabase/auth-helpers-react';// Helper to debounce API calls\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function debounce(fn,delay){var timeoutId;return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}if(timeoutId){clearTimeout(timeoutId);}timeoutId=setTimeout(function(){fn.apply(void 0,args);},delay);};}function createGoogleCalendarEvent(_x,_x2,_x3,_x4,_x5){return _createGoogleCalendarEvent.apply(this,arguments);}function _createGoogleCalendarEvent(){_createGoogleCalendarEvent=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(event,calendarId,session,signOut,setRateLimitInfo){var url,newEvent;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:console.log('Attempting to create a new Google Calendar event:',event);if(session.provider_token){_context2.next=5;break;}console.error('No valid session token available. Logging out.');signOut();return _context2.abrupt(\"return\",null);case 5:url=\"https://www.googleapis.com/calendar/v3/calendars/\".concat(calendarId,\"/events\");newEvent={summary:event.title,description:event.description,start:{dateTime:event.start.toISOString()},end:{dateTime:event.end.toISOString()},location:\"\".concat(event.streetAddress,\", \").concat(event.city,\", \").concat(event.state,\", \").concat(event.zipCode)};console.log('New event data:',newEvent);// Debounce the fetch request to prevent rapid duplicate requests\nreturn _context2.abrupt(\"return\",debounce(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(url,{method:'POST',headers:{'Authorization':'Bearer '+session.provider_token,'Content-Type':'application/json'},body:JSON.stringify(newEvent)}).then(function(response){// Capture rate limit info from headers\nvar remaining=response.headers.get('X-RateLimit-Remaining');var limit=response.headers.get('X-RateLimit-Limit');var reset=response.headers.get('X-RateLimit-Reset');setRateLimitInfo({remaining:remaining,limit:limit,reset:reset});return response.json();}).then(function(data){console.log('Google Calendar creation response:',data);if(data.error){console.error('Error creating event:',data.error);if(data.error.code===401){console.error('Unauthorized - Logging out');signOut();// Logout if unauthorized\n}return null;}else{console.log('New event successfully created:',data);return data.id;}}).catch(function(error){return console.error('Error during fetch request:',error);});case 2:return _context.abrupt(\"return\",_context.sent);case 3:case\"end\":return _context.stop();}},_callee);})),1000// 1 second delay between API calls\n));case 9:case\"end\":return _context2.stop();}},_callee2);}));return _createGoogleCalendarEvent.apply(this,arguments);}function updateAirtableWithGoogleEventId(_x6,_x7){return _updateAirtableWithGoogleEventId.apply(this,arguments);}function _updateAirtableWithGoogleEventId(){_updateAirtableWithGoogleEventId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(airtableRecordId,googleEventId){var url,updateData;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:console.log('Updating Airtable with new Google Event ID:',googleEventId);url=\"https://api.airtable.com/v0/appO21PVRA4Qa087I/tbl6EeKPsNuEvt5yJ/\".concat(airtableRecordId);updateData={fields:{GoogleEventId:googleEventId}};console.log('Airtable update data:',updateData);_context3.next=6;return fetch(url,{method:'PATCH',headers:{'Authorization':'Bearer patXTUS9m8os14OO1.6a81b7bc4dd88871072fe71f28b568070cc79035bc988de3d4228d52239c8238','Content-Type':'application/json'},body:JSON.stringify(updateData)}).then(function(response){return response.json();}).then(function(data){console.log('Airtable API response for update:',data);if(data.error){console.error('Error updating Airtable with Google Event ID:',data.error);}else{console.log('Airtable record successfully updated:',data);}}).catch(function(error){return console.error('Error during fetch request:',error);});case 6:return _context3.abrupt(\"return\",_context3.sent);case 7:case\"end\":return _context3.stop();}},_callee3);}));return _updateAirtableWithGoogleEventId.apply(this,arguments);}function fetchAirtableEvents(){return _fetchAirtableEvents.apply(this,arguments);}function _fetchAirtableEvents(){_fetchAirtableEvents=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var retryCount,url,maxRetries,response,retryAfter,waitTime,data,_args4=arguments;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:retryCount=_args4.length>0&&_args4[0]!==undefined?_args4[0]:0;console.log('Fetching events from Airtable');url=\"https://api.airtable.com/v0/appO21PVRA4Qa087I/tbl6EeKPsNuEvt5yJ\";maxRetries=1;_context4.prev=4;_context4.next=7;return fetch(url,{headers:{'Authorization':'Bearer patXTUS9m8os14OO1.6a81b7bc4dd88871072fe71f28b568070cc79035bc988de3d4228d52239c8238','Content-Type':'application/json'}});case 7:response=_context4.sent;if(response.ok){_context4.next=23;break;}if(!(response.status===429)){_context4.next=22;break;}// Handle rate limiting\nretryAfter=response.headers.get('Retry-After');waitTime=retryAfter?parseInt(retryAfter)*1000:Math.pow(2,retryCount)*1000;console.warn(\"Rate limit hit. Retrying after \".concat(waitTime,\"ms...\"));if(!(retryCount<maxRetries)){_context4.next=19;break;}_context4.next=16;return new Promise(function(resolve){return setTimeout(resolve,waitTime);});case 16:return _context4.abrupt(\"return\",fetchAirtableEvents(retryCount+1));case 19:throw new Error('Max retries exceeded');case 20:_context4.next=23;break;case 22:throw new Error(\"HTTP error! status: \".concat(response.status));case 23:_context4.next=25;return response.json();case 25:data=_context4.sent;console.log('Fetched data from Airtable:',data);return _context4.abrupt(\"return\",data.records.filter(function(record){return record.fields['Calendar Event Name']&&record.fields['startDate']&&record.fields['endDate'];})// Skip empty records\n.map(function(record){return{id:record.id,title:record.fields['Calendar Event Name']||\"Untitled Event\",start:new Date(record.fields['startDate']),end:new Date(record.fields['endDate']),description:record.fields['Billable Reason (If Billable)']||'',branch:record.fields['b']||'Unknown',homeownerName:record.fields['Homeowner Name']||'Unknown',streetAddress:record.fields['Street Address']||'Unknown',city:record.fields['City']||'Unknown',state:record.fields['State']||'Unknown',zipCode:record.fields['Zip Code']||'Unknown',googleEventId:record.fields['GoogleEventId']||null};}));case 30:_context4.prev=30;_context4.t0=_context4[\"catch\"](4);console.error('Error fetching events from Airtable:',_context4.t0);if(!(retryCount<maxRetries)){_context4.next=38;break;}console.log(\"Retrying fetch attempt \".concat(retryCount+1,\" of \").concat(maxRetries,\"...\"));return _context4.abrupt(\"return\",fetchAirtableEvents(retryCount+1));case 38:throw _context4.t0;case 39:case\"end\":return _context4.stop();}},_callee4,null,[[4,30]]);}));return _fetchAirtableEvents.apply(this,arguments);}function checkForDuplicateEvent(_x8,_x9,_x10){return _checkForDuplicateEvent.apply(this,arguments);}function _checkForDuplicateEvent(){_checkForDuplicateEvent=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(event,calendarId,session){var url,response,data;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:url=\"https://www.googleapis.com/calendar/v3/calendars/\".concat(calendarId,\"/events?timeMin=\").concat(event.start.toISOString(),\"&timeMax=\").concat(event.end.toISOString());_context5.next=3;return fetch(url,{headers:{'Authorization':'Bearer '+session.provider_token}});case 3:response=_context5.sent;_context5.next=6;return response.json();case 6:data=_context5.sent;if(!data.items){_context5.next=9;break;}return _context5.abrupt(\"return\",data.items.some(function(existingEvent){return existingEvent.summary===event.title&&existingEvent.location===\"\".concat(event.streetAddress,\", \").concat(event.city,\", \").concat(event.state,\", \").concat(event.zipCode);}));case 9:return _context5.abrupt(\"return\",false);case 10:case\"end\":return _context5.stop();}},_callee5);}));return _checkForDuplicateEvent.apply(this,arguments);}function sleep(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});}function populateGoogleCalendarWithAirtableRecords(_x11,_x12,_x13,_x14,_x15,_x16,_x17){return _populateGoogleCalendarWithAirtableRecords.apply(this,arguments);}function _populateGoogleCalendarWithAirtableRecords(){_populateGoogleCalendarWithAirtableRecords=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(calendarId,calendarName,session,signOut,setAddedRecords,setFailedRecords,setRateLimitInfo){var airtableEvents,added,failed,_iterator,_step,event,isDuplicate,googleEventId;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:console.log(\"Populating Google Calendar (\".concat(calendarName,\") with Airtable records...\"));_context6.next=3;return fetchAirtableEvents();case 3:airtableEvents=_context6.sent;added=[];failed=[];_iterator=_createForOfIteratorHelper(airtableEvents);_context6.prev=7;_iterator.s();case 9:if((_step=_iterator.n()).done){_context6.next=39;break;}event=_step.value;if(!(event.branch.toLowerCase()==='unknown'||event.branch.toLowerCase()!==calendarName.toLowerCase())){_context6.next=14;break;}console.log(\"Skipping event \\\"\".concat(event.title,\"\\\" due to branch \\\"\").concat(event.branch,\"\\\" not matching \\\"\").concat(calendarName,\"\\\" or being \\\"Unknown\\\"\"));return _context6.abrupt(\"continue\",37);case 14:if(!event.googleEventId){_context6.next=17;break;}console.log(\"Skipping already synced event: \".concat(event.title));return _context6.abrupt(\"continue\",37);case 17:_context6.next=19;return checkForDuplicateEvent(event,calendarId,session);case 19:isDuplicate=_context6.sent;if(!isDuplicate){_context6.next=24;break;}console.log(\"Duplicate event found: \\\"\".concat(event.title,\"\\\". Skipping...\"));failed.push(event.title);return _context6.abrupt(\"continue\",37);case 24:_context6.next=26;return createGoogleCalendarEvent(event,calendarId,session,signOut,setRateLimitInfo);case 26:googleEventId=_context6.sent;if(!googleEventId){_context6.next=34;break;}console.log('New Google Event ID created:',googleEventId);_context6.next=31;return updateAirtableWithGoogleEventId(event.id,googleEventId);case 31:added.push(event.title);_context6.next=35;break;case 34:failed.push(event.title);case 35:_context6.next=37;return sleep(600000);case 37:_context6.next=9;break;case 39:_context6.next=44;break;case 41:_context6.prev=41;_context6.t0=_context6[\"catch\"](7);_iterator.e(_context6.t0);case 44:_context6.prev=44;_iterator.f();return _context6.finish(44);case 47:setAddedRecords(function(prev){return[].concat(_toConsumableArray(prev),added);});setFailedRecords(function(prev){return[].concat(_toConsumableArray(prev),failed);});console.log(\"Finished populating Google Calendar (\".concat(calendarName,\") with Airtable records.\"));case 50:case\"end\":return _context6.stop();}},_callee6,null,[[7,41,44,47]]);}));return _populateGoogleCalendarWithAirtableRecords.apply(this,arguments);}function CalendarSection(_ref){var calendarId=_ref.calendarId,calendarName=_ref.calendarName,session=_ref.session,signOut=_ref.signOut,setAddedRecords=_ref.setAddedRecords,setFailedRecords=_ref.setFailedRecords,setRateLimitInfo=_ref.setRateLimitInfo;useEffect(function(){console.log('Session state:',session);var syncEvents=function syncEvents(){if(session){if(!session.provider_token){console.error('No valid session token found. Logging out.');signOut();return;}populateGoogleCalendarWithAirtableRecords(calendarId,calendarName,session,signOut,setAddedRecords,setFailedRecords,setRateLimitInfo).then(function(){return console.log(\"Finished syncing Airtable events to Google Calendar (\".concat(calendarName,\")\"));}).catch(function(error){return console.error(\"Error syncing Airtable to Google Calendar (\".concat(calendarName,\"):\"),error);});}};// Run syncEvents immediately when the component mounts\nsyncEvents();// Set up an interval to run syncEvents every 15 minutes (900000 ms)\nvar intervalId=setInterval(syncEvents,900000);// Clear the interval when the component unmounts\nreturn function(){return clearInterval(intervalId);};},[session,signOut,calendarId,calendarName,setAddedRecords,setFailedRecords,setRateLimitInfo]);return/*#__PURE__*/_jsx(\"div\",{className:\"calendar-item\",children:/*#__PURE__*/_jsx(\"h2\",{children:calendarName})});}function App(){var session=useSession();var supabase=useSupabaseClient();var _useSessionContext=useSessionContext(),isLoading=_useSessionContext.isLoading;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),addedRecords=_useState2[0],setAddedRecords=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),failedRecords=_useState4[0],setFailedRecords=_useState4[1];var _useState5=useState({remaining:null,limit:null,reset:null}),_useState6=_slicedToArray(_useState5,2),rateLimitInfo=_useState6[0],setRateLimitInfo=_useState6[1];// Sort calendar info alphabetically by name\nvar calendarInfo=[{id:'c_d113e252e0e5c8cfbf17a13149707a30d3c0fbeeff1baaac7a46940c2cc448ca@group.calendar.google.com',name:'Charleston'},{id:'c_03867438b82e5dfd8d4d3b6096c8eb1c715425fa012054cc95f8dea7ef41c79b@group.calendar.google.com',name:'Greensboro'},{id:'c_ad562073f4db2c47279af5aa40e53fc2641b12ad2497ccd925feb220a0f1abee@group.calendar.google.com',name:'Myrtle Beach'},{id:'c_45db4e963c3363676038697855d7aacfd1075da441f9308e44714768d4a4f8de@group.calendar.google.com',name:'Wilmington'},{id:'https://calendar.google.com/calendar/embed?src=c_0476130ac741b9c58b404c737a8068a8b1b06ba1de2a84cff08c5d15ced54edf%40group.calendar.google.com&ctz=America%2FToronto',name:'Grenville'},{id:'https://calendar.google.com/calendar/embed?src=c_df033dd6c81bb3cbb5c6fdfd58dd2931e145e061b8a04ea0c13c79963cb6d515%40group.calendar.google.com&ctz=America%2FToronto',name:'Columbia'},{id:'warranty@vanirinstalledsales.com',name:'Raleigh'}].sort(function(a,b){return a.name.localeCompare(b.name);});var getGreeting=function getGreeting(){var currentHour=new Date().getHours();if(currentHour<12){return\"Good morning\";}else if(currentHour<18){return\"Good afternoon\";}else{return\"Good evening\";}};if(isLoading){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Warranty Calendar\"}),/*#__PURE__*/_jsx(\"div\",{style:{width:\"100%\",margin:\"0 auto\"},children:session?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h2\",{children:[getGreeting(),\" \",session.user.email]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"calendar-grid\",children:calendarInfo.map(function(calendar){return/*#__PURE__*/_jsx(CalendarSection,{calendarId:calendar.id,calendarName:calendar.name,session:session,signOut:function signOut(){return supabase.auth.signOut();},setAddedRecords:setAddedRecords,setFailedRecords:setFailedRecords,setRateLimitInfo:setRateLimitInfo},calendar.id);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"records-summary\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Records Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"added-records\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Successfully Added Records:\"}),addedRecords.length>0?/*#__PURE__*/_jsx(\"ul\",{children:addedRecords.map(function(record,index){return/*#__PURE__*/_jsx(\"li\",{children:record},index);})}):/*#__PURE__*/_jsx(\"p\",{children:\"No records added.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"failed-records\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Failed to Add Records:\"}),failedRecords.length>0?/*#__PURE__*/_jsx(\"ul\",{children:failedRecords.map(function(record,index){return/*#__PURE__*/_jsx(\"li\",{children:record},index);})}):/*#__PURE__*/_jsx(\"p\",{children:\"No records failed.\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rate-limit-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Google Calendar API Rate Limit Information:\"}),rateLimitInfo.limit!==null?/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsxs(\"li\",{children:[\"Limit: \",rateLimitInfo.limit]}),/*#__PURE__*/_jsxs(\"li\",{children:[\"Remaining: \",rateLimitInfo.remaining]}),/*#__PURE__*/_jsxs(\"li\",{children:[\"Reset Time: \",new Date(rateLimitInfo.reset*1000).toLocaleTimeString()]})]}):/*#__PURE__*/_jsx(\"p\",{children:\"No rate limit information available.\"})]}),/*#__PURE__*/_jsx(\"p\",{}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return supabase.auth.signOut();},children:\"Sign Out\"})]}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return supabase.auth.signInWithOAuth({provider:'google',options:{scopes:'https://www.googleapis.com/auth/calendar'}});},children:\"Sign In With Google\"})})})]})});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useSession","useSupabaseClient","useSessionContext","debounce","fn","delay","timeoutId","args","clearTimeout","setTimeout","createGoogleCalendarEvent","event","calendarId","session","signOut","setRateLimitInfo","console","log","provider_token","error","url","newEvent","summary","title","description","start","dateTime","toISOString","end","location","streetAddress","city","state","zipCode","fetch","method","headers","body","JSON","stringify","then","response","remaining","get","limit","reset","json","data","code","id","catch","updateAirtableWithGoogleEventId","airtableRecordId","googleEventId","updateData","fields","GoogleEventId","fetchAirtableEvents","retryCount","maxRetries","ok","status","retryAfter","waitTime","parseInt","Math","pow","warn","Promise","resolve","Error","records","filter","record","map","Date","branch","homeownerName","checkForDuplicateEvent","items","some","existingEvent","sleep","ms","populateGoogleCalendarWithAirtableRecords","calendarName","setAddedRecords","setFailedRecords","airtableEvents","added","failed","toLowerCase","isDuplicate","push","prev","CalendarSection","syncEvents","intervalId","setInterval","clearInterval","App","supabase","isLoading","addedRecords","failedRecords","rateLimitInfo","calendarInfo","name","sort","a","b","localeCompare","getGreeting","currentHour","getHours","width","margin","user","email","calendar","auth","length","index","toLocaleTimeString","signInWithOAuth","provider","options","scopes"],"sources":["/Users/richardmcgirt/Desktop/Warrenty2-/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport './App.css';\nimport { useSession, useSupabaseClient, useSessionContext } from '@supabase/auth-helpers-react';\n\n// Helper to debounce API calls\nfunction debounce(fn, delay) {\n  let timeoutId;\n  return (...args) => {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = setTimeout(() => {\n      fn(...args);\n    }, delay);\n  };\n}\n\nasync function createGoogleCalendarEvent(event, calendarId, session, signOut, setRateLimitInfo) {\n  console.log('Attempting to create a new Google Calendar event:', event);\n\n  if (!session.provider_token) {\n    console.error('No valid session token available. Logging out.');\n    signOut();\n    return null;\n  }\n\n  const url = `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events`;\n\n  const newEvent = {\n    summary: event.title,\n    description: event.description,\n    start: { dateTime: event.start.toISOString() },\n    end: { dateTime: event.end.toISOString() },\n    location: `${event.streetAddress}, ${event.city}, ${event.state}, ${event.zipCode}`,\n  };\n\n  console.log('New event data:', newEvent);\n\n  // Debounce the fetch request to prevent rapid duplicate requests\n  return debounce(\n    async () => {\n      return await fetch(url, {\n        method: 'POST',\n        headers: {\n          'Authorization': 'Bearer ' + session.provider_token,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(newEvent)\n      }).then(response => {\n        // Capture rate limit info from headers\n        const remaining = response.headers.get('X-RateLimit-Remaining');\n        const limit = response.headers.get('X-RateLimit-Limit');\n        const reset = response.headers.get('X-RateLimit-Reset');\n        setRateLimitInfo({ remaining, limit, reset });\n\n        return response.json();\n      }).then(data => {\n        console.log('Google Calendar creation response:', data);\n        if (data.error) {\n          console.error('Error creating event:', data.error);\n          if (data.error.code === 401) {\n            console.error('Unauthorized - Logging out');\n            signOut(); // Logout if unauthorized\n          }\n          return null;\n        } else {\n          console.log('New event successfully created:', data);\n          return data.id;\n        }\n      }).catch(error => console.error('Error during fetch request:', error));\n    },\n    1000 // 1 second delay between API calls\n  );\n}\n\nasync function updateAirtableWithGoogleEventId(airtableRecordId, googleEventId) {\n  console.log('Updating Airtable with new Google Event ID:', googleEventId);\n\n  const url = `https://api.airtable.com/v0/appO21PVRA4Qa087I/tbl6EeKPsNuEvt5yJ/${airtableRecordId}`;\n  const updateData = {\n    fields: {\n      GoogleEventId: googleEventId\n    }\n  };\n\n  console.log('Airtable update data:', updateData);\n\n  return await fetch(url, {\n    method: 'PATCH',\n    headers: {\n      'Authorization': 'Bearer patXTUS9m8os14OO1.6a81b7bc4dd88871072fe71f28b568070cc79035bc988de3d4228d52239c8238',\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(updateData)\n  }).then(response => response.json())\n    .then(data => {\n      console.log('Airtable API response for update:', data);\n      if (data.error) {\n        console.error('Error updating Airtable with Google Event ID:', data.error);\n      } else {\n        console.log('Airtable record successfully updated:', data);\n      }\n    }).catch(error => console.error('Error during fetch request:', error));\n}\n\nasync function fetchAirtableEvents(retryCount = 0) {\n  console.log('Fetching events from Airtable');\n\n  const url = `https://api.airtable.com/v0/appO21PVRA4Qa087I/tbl6EeKPsNuEvt5yJ`;\n  const maxRetries = 1;\n\n  try {\n    const response = await fetch(url, {\n      headers: {\n        'Authorization': 'Bearer patXTUS9m8os14OO1.6a81b7bc4dd88871072fe71f28b568070cc79035bc988de3d4228d52239c8238',\n        'Content-Type': 'application/json'\n      }\n    });\n\n    if (!response.ok) {\n      if (response.status === 429) {\n        // Handle rate limiting\n        const retryAfter = response.headers.get('Retry-After');\n        const waitTime = retryAfter ? parseInt(retryAfter) * 1000 : Math.pow(2, retryCount) * 1000;\n\n        console.warn(`Rate limit hit. Retrying after ${waitTime}ms...`);\n\n        if (retryCount < maxRetries) {\n          await new Promise(resolve => setTimeout(resolve, waitTime));\n          return fetchAirtableEvents(retryCount + 1); // Retry with incremented retry count\n        } else {\n          throw new Error('Max retries exceeded');\n        }\n      } else {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n    }\n\n    const data = await response.json();\n    console.log('Fetched data from Airtable:', data);\n\n    return data.records\n      .filter(record => record.fields['Calendar Event Name'] && record.fields['startDate'] && record.fields['endDate']) // Skip empty records\n      .map(record => ({\n        id: record.id,\n        title: record.fields['Calendar Event Name'] || \"Untitled Event\",\n        start: new Date(record.fields['startDate']),\n        end: new Date(record.fields['endDate']),\n        description: record.fields['Billable Reason (If Billable)'] || '',\n        branch: record.fields['b'] || 'Unknown',\n        homeownerName: record.fields['Homeowner Name'] || 'Unknown',\n        streetAddress: record.fields['Street Address'] || 'Unknown',\n        city: record.fields['City'] || 'Unknown',\n        state: record.fields['State'] || 'Unknown',\n        zipCode: record.fields['Zip Code'] || 'Unknown',\n        googleEventId: record.fields['GoogleEventId'] || null,\n      }));\n\n  } catch (error) {\n    console.error('Error fetching events from Airtable:', error);\n\n    if (retryCount < maxRetries) {\n      console.log(`Retrying fetch attempt ${retryCount + 1} of ${maxRetries}...`);\n      return fetchAirtableEvents(retryCount + 1);\n    } else {\n      throw error; // Re-throw the error after max retries\n    }\n  }\n}\n\n\n\n\nasync function checkForDuplicateEvent(event, calendarId, session) {\n  const url = `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events?timeMin=${event.start.toISOString()}&timeMax=${event.end.toISOString()}`;\n  \n  const response = await fetch(url, {\n    headers: {\n      'Authorization': 'Bearer ' + session.provider_token,\n    },\n  });\n\n  const data = await response.json();\n  \n  if (data.items) {\n    return data.items.some(existingEvent =>\n      existingEvent.summary === event.title &&\n      existingEvent.location === `${event.streetAddress}, ${event.city}, ${event.state}, ${event.zipCode}`\n    );\n  }\n\n  return false;\n}\n\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nasync function populateGoogleCalendarWithAirtableRecords(calendarId, calendarName, session, signOut, setAddedRecords, setFailedRecords, setRateLimitInfo) {\n  console.log(`Populating Google Calendar (${calendarName}) with Airtable records...`);\n\n  const airtableEvents = await fetchAirtableEvents();\n  const added = [];\n  const failed = [];\n\n  for (const event of airtableEvents) {\n    // Skip events where the branch is \"Unknown\" or does not match the calendar name\n    if (event.branch.toLowerCase() === 'unknown' || event.branch.toLowerCase() !== calendarName.toLowerCase()) {\n      console.log(`Skipping event \"${event.title}\" due to branch \"${event.branch}\" not matching \"${calendarName}\" or being \"Unknown\"`);\n      continue;\n    }\n\n    if (event.googleEventId) {\n      console.log(`Skipping already synced event: ${event.title}`);\n      continue;\n    }\n\n    const isDuplicate = await checkForDuplicateEvent(event, calendarId, session);\n    if (isDuplicate) {\n      console.log(`Duplicate event found: \"${event.title}\". Skipping...`);\n      failed.push(event.title);\n      continue;\n    }\n\n    const googleEventId = await createGoogleCalendarEvent(event, calendarId, session, signOut, setRateLimitInfo);\n    if (googleEventId) {\n      console.log('New Google Event ID created:', googleEventId);\n      await updateAirtableWithGoogleEventId(event.id, googleEventId);\n      added.push(event.title);\n    } else {\n      failed.push(event.title);\n    }\n\n    // Introduce a delay of 1 second between requests\n    await sleep(600000);\n  }\n\n  setAddedRecords(prev => [...prev, ...added]);\n  setFailedRecords(prev => [...prev, ...failed]);\n\n  console.log(`Finished populating Google Calendar (${calendarName}) with Airtable records.`);\n}\n\n\nfunction CalendarSection({ calendarId, calendarName, session, signOut, setAddedRecords, setFailedRecords, setRateLimitInfo }) {\n  useEffect(() => {\n    console.log('Session state:', session);\n\n    const syncEvents = () => {\n      if (session) {\n        if (!session.provider_token) {\n          console.error('No valid session token found. Logging out.');\n          signOut();\n          return;\n        }\n\n        populateGoogleCalendarWithAirtableRecords(\n          calendarId, \n          calendarName, \n          session, \n          signOut, \n          setAddedRecords, \n          setFailedRecords, \n          setRateLimitInfo\n        )\n          .then(() => console.log(`Finished syncing Airtable events to Google Calendar (${calendarName})`))\n          .catch(error => console.error(`Error syncing Airtable to Google Calendar (${calendarName}):`, error));\n      }\n    };\n\n    // Run syncEvents immediately when the component mounts\n    syncEvents();\n\n    // Set up an interval to run syncEvents every 15 minutes (900000 ms)\n    const intervalId = setInterval(syncEvents, 900000);\n\n    // Clear the interval when the component unmounts\n    return () => clearInterval(intervalId);\n  }, [session, signOut, calendarId, calendarName, setAddedRecords, setFailedRecords, setRateLimitInfo]);\n\n  return (\n    <div className=\"calendar-item\">\n      <h2>{calendarName}</h2>\n    </div>\n  );\n}\n\n\nfunction App() {\n  const session = useSession();\n  const supabase = useSupabaseClient();\n  const { isLoading } = useSessionContext();\n\n  const [addedRecords, setAddedRecords] = useState([]);\n  const [failedRecords, setFailedRecords] = useState([]);\n  const [rateLimitInfo, setRateLimitInfo] = useState({ remaining: null, limit: null, reset: null });\n\n  // Sort calendar info alphabetically by name\n  const calendarInfo = [\n    { id: 'c_d113e252e0e5c8cfbf17a13149707a30d3c0fbeeff1baaac7a46940c2cc448ca@group.calendar.google.com', name: 'Charleston' },\n    { id: 'c_03867438b82e5dfd8d4d3b6096c8eb1c715425fa012054cc95f8dea7ef41c79b@group.calendar.google.com', name: 'Greensboro' },\n    { id: 'c_ad562073f4db2c47279af5aa40e53fc2641b12ad2497ccd925feb220a0f1abee@group.calendar.google.com', name: 'Myrtle Beach' },\n    { id: 'c_45db4e963c3363676038697855d7aacfd1075da441f9308e44714768d4a4f8de@group.calendar.google.com', name: 'Wilmington' },\n    { id: 'https://calendar.google.com/calendar/embed?src=c_0476130ac741b9c58b404c737a8068a8b1b06ba1de2a84cff08c5d15ced54edf%40group.calendar.google.com&ctz=America%2FToronto', name: 'Grenville'},\n    { id: 'https://calendar.google.com/calendar/embed?src=c_df033dd6c81bb3cbb5c6fdfd58dd2931e145e061b8a04ea0c13c79963cb6d515%40group.calendar.google.com&ctz=America%2FToronto', name: 'Columbia'},\n    { id: 'warranty@vanirinstalledsales.com', name: 'Raleigh' }\n  ].sort((a, b) => a.name.localeCompare(b.name));\n\n  const getGreeting = () => {\n    const currentHour = new Date().getHours();\n    if (currentHour < 12) {\n      return \"Good morning\";\n    } else if (currentHour < 18) {\n      return \"Good afternoon\";\n    } else {\n      return \"Good evening\";\n    }\n  };\n\n  if (isLoading) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <div className=\"App\">\n      <div className=\"container\">\n        <h1>Warranty Calendar</h1>\n        <div style={{ width: \"100%\", margin: \"0 auto\" }}>\n          {session ?\n            <>\n              <h2>{getGreeting()} {session.user.email}</h2>\n              <hr />\n              <div className=\"calendar-grid\">\n                {calendarInfo.map(calendar => (\n                  <CalendarSection\n                    key={calendar.id}\n                    calendarId={calendar.id}\n                    calendarName={calendar.name}\n                    session={session}\n                    signOut={() => supabase.auth.signOut()}\n                    setAddedRecords={setAddedRecords}\n                    setFailedRecords={setFailedRecords}\n                    setRateLimitInfo={setRateLimitInfo}\n                  />\n                ))}\n              </div>\n              <div className=\"records-summary\">\n                <h3>Records Summary</h3>\n                <div className=\"summary-container\">\n                  <div className=\"added-records\">\n                    <h4>Successfully Added Records:</h4>\n                    {addedRecords.length > 0 ? (\n                      <ul>\n                        {addedRecords.map((record, index) => (\n                          <li key={index}>{record}</li>\n                        ))}\n                      </ul>\n                    ) : (\n                      <p>No records added.</p>\n                    )}\n                  </div>\n                  <div className=\"failed-records\">\n                    <h4>Failed to Add Records:</h4>\n                    {failedRecords.length > 0 ? (\n                      <ul>\n                        {failedRecords.map((record, index) => (\n                          <li key={index}>{record}</li>\n                        ))}\n                      </ul>\n                    ) : (\n                      <p>No records failed.</p>\n                    )}\n                  </div>\n                </div>\n              </div>\n              <div className=\"rate-limit-info\">\n                <h4>Google Calendar API Rate Limit Information:</h4>\n                {rateLimitInfo.limit !== null ? (\n                  <ul>\n                    <li>Limit: {rateLimitInfo.limit}</li>\n                    <li>Remaining: {rateLimitInfo.remaining}</li>\n                    <li>Reset Time: {new Date(rateLimitInfo.reset * 1000).toLocaleTimeString()}</li>\n                  </ul>\n                ) : (\n                  <p>No rate limit information available.</p>\n                )}\n              </div>\n              <p></p>\n              <button onClick={() => supabase.auth.signOut()}>Sign Out</button>\n            </>\n            :\n            <>\n              <button onClick={() => supabase.auth.signInWithOAuth({ provider: 'google', options: { scopes: 'https://www.googleapis.com/auth/calendar' } })}>\n                Sign In With Google\n              </button>\n            </>\n          }\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}